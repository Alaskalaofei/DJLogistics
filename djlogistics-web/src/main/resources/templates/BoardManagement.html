<!DOCTYPE html>
<html>

	<head>
		<meta charset="utf-8">
		<title></title>
		<link rel="icon" href="images/favicon.ico">
		<link rel="stylesheet" href="../lib/layui-v2.5.4/css/layui.css" media="all">
		<link rel="stylesheet" href="../css/layuimini.css" media="all">
		<link rel="stylesheet" href="../css/layuimini.css" media="all">
		<style type="text/css">
			.btn-bgcolor {
				background-color: #286ED6;
				width: 80px;
			}

			.btn-bgcolor2 {
				margin-top: 14.4%;
				background-color: #286ED6;
				width: 70px;
			}

			.btn-bgcolor3 {
				margin-top: 14.4%;
				width: 70px;
			}

			#luxian {
				position: absolute;
				left: 14%;
				top: 25%;
			}
		</style>
	</head>

	<body>
		<br />
		<div style="margin-left: 20px;">
			<!-- 导航start -->
			<form class="layui-form layui-form-pane" action="">
				<div class="layui-form-item">
					<div class="layui-inline">
						<button type="button" class="layui-btn layui-btn-sm" style="background-color: #0fba38;width: 70px;" id="AddUpperPlate">新增</button>
					</div>
					<div class="layui-inline">
						<button type="button" class="layui-btn layui-btn-sm " style="background-color: #286ed6;width: 70px;" id="UpdUpperPlate">修改</button>
					</div>
					<div class="layui-inline">
						<button type="button" class="layui-btn layui-btn-sm " style="background-color: #e9161e;width: 120px;" id="cancelTheUpperPlate">撤销上板</button>
					</div>
					<div class="layui-inline">
						<a href="javascript:void(0)"  data-iframe-tab="UpperPlate.html" data-title="上板" data-icon="fa fa-hourglass-end"><button type="button" class="layui-btn layui-btn-sm " style="background-color: #286ed6;width: 120px;">继续上板</button></a>
					</div>
					<div class="layui-inline">
						<a href="javascript:void(0)"  data-iframe-tab="BoardOnCompletion.html" data-title="关联班次" data-icon="fa fa-hourglass-end"><button type="button" class="layui-btn layui-btn-sm  " style="background-color: #286ed6;width: 120px;">关联班次</button></a>
					</div>
				</div>
				<!-- 导航end -->
				<!-- 搜索start -->
				<div class="layui-form-item">
					<div class="layui-inline" style="width: 150px;">
						<div class="layui-form-item">
							<select name="is" id="is" lay-verify="required" lay-search="">
								<option value="0">上板板号</option>
								<option value="1">订单号码</option>
							</select>
						</div>
						<div class="layui-form-item" style="margin-top:-11% !important;">
							<textarea class="layui-textarea" id="number"></textarea>
							<div class="layui-form-item">
								<button type="button" class="layui-btn layui-btn-sm" style="width: 9.375rem; margin-top: 2px;"> 清空</button>
							</div>
						</div>
					</div>
					<div class="layui-inline" style="margin-top: -7% !important;">
						<div class="layui-inline">
							<div class="layui-form-item">
								建板日期
							</div>
							<div class="layui-form-item" style="width: 310px;">
								<input type="text" class="layui-input" id="buildBoardDate" placeholder="开始	时间    -   结束时间">
							</div>
						</div>
						<div class="layui-inline">
							<div class="layui-form-item">
								上板网点
							</div>
							<div class="layui-form-item" style="width: 150px;">
								<select name="upperPlateOutlets" id="upperPlateOutlets" lay-verify="required" lay-search="">
									<option value=""></option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<div class="layui-form-item">
								派件网点
							</div>
							<div class="layui-form-item" style="width: 150px;">
								<select name="deliveryOutlets" id="deliveryOutlets" lay-verify="required" lay-search="">
									<option value=""></option>
								</select>
							</div>
						</div>
						<div class="layui-inline">
							<div class="layui-form-item">
								上板状态
							</div>
							<div class="layui-form-item" style="width: 150px;">
								<select name="upperState" id="upperState" lay-verify="required" lay-search="">
									<option value=""></option>
									<option value="0">待上板</option>
									<option value="1">已上板</option>
									<option value="2">已出货</option>
									<option value="3">已撤销</option>
								</select>
							</div>
						</div>

					</div>
					<div class="layui-form-item" id="luxian">
						<div>
							<div class="layui-inline">
								<div class="layui-form-item">
									上板策略
								</div>
								<div class="layui-form-item" style="width: 200px;">
									<select name="boardStrategy" id="boardStrategy" lay-verify="required" lay-search="">

									</select>
								</div>
							</div>
							<div class="layui-inline">
								<div class="layui-form-item">
									数据来源
								</div>
								<div class="layui-form-item" style="width: 200px;">
									<select name="dataSource" id="dataSource" lay-verify="required" lay-search="">
										<option value=""></option>
										<option value="0">快速新增</option>
										<option value="1">单板新增</option>
										<option value="2">批量预打</option>
									</select>
								</div>
							</div>
							<div class="layui-inline">
								<div class="layui-form-item">
									报关方式
								</div>
								<div class="layui-form-item" style="width: 200px;">
									<select name="cdm" id="cdm" lay-verify="required" lay-search="">
										<option value=""></option>
									</select>
								</div>
							</div>
							<div class="layui-inline" style="margin-top: -5px;">
								<button type="button" class="layui-btn layui-btn-sm  btn-bgcolor2" id="select">查询</button>
								<button type="reset" class="layui-btn layui-btn-sm  layui-btn-primary btn-bgcolor3">重置</button>
							</div>
						</div>
					</div>
					<!-- 搜索end -->

					<!-- 显示数据start --><br/>
					<table class="layui-hide" id="myTable"></table>
					<!-- 显示数据end -->
			</form>
		</div>
		<script src="../lib/layui-v2.5.4/layui.js" charset="utf-8"></script>
		<script src="../js/lay-config.js?v=1.0.4" charset="utf-8"></script>
		<script>
			layui.use(['element', 'layer', 'form', 'laydate','layuimini','table'], function() {
				var $ = layui.jquery,
					element = layui.element,
					layer = layui.layer,
					form = layui.form,
					table = layui.table,
					laydate = layui.laydate;
				//日期
				laydate.render({
					elem: '#buildBoardDate',
					type: 'datetime',
					range: '到',
					format: 'yyyy-M-d H:m:s'
				});

				//查询并渲染上板网点下拉框
				$("#upperPlateOutlets").load("/up/getOutlet",function(result){
					$("#upperPlateOutlets").append("<option value=''>请选择</option>");
					$.each(eval("("+result+")"),function(index,item){
						$("#upperPlateOutlets").append("<option value='"+item.oid+"'>"+item.name+"</option>");
					})
					form.render();
				})
				//查询并渲染派件网点下拉框
				$("#deliveryOutlets").load("/up/getOutlet",function(result){
					$("#deliveryOutlets").append("<option value=''>请选择</option>");
					$.each(eval("("+result+")"),function(index,item){
						$("#deliveryOutlets").append("<option value='"+item.oid+"'>"+item.name+"</option>");
					})
					form.render();
				})

				//查询并渲染上板策略下拉框
				$("#boardStrategy").load("/up/getBS",function(result){
					$("#boardStrategy").append("<option value=''>请选择</option>");
					$.each(eval("("+result+")"),function(index,item){
						$("#boardStrategy").append("<option value='"+item.bid+"'>"+item.tboardStrategy+"</option>");
					})
					form.render();
				})

				//查询并渲染报关方式下拉框
				$("#cdm").load("/up/getcdm",function(result){
					$("#cdm").append("<option value=''>请选择</option>");
					$.each(eval("("+result+")"),function(index,item){
						$("#cdm").append("<option value='"+item.cid+"'>"+item.customsDeclarationMethod+"</option>");
					})
					form.render();
				})

				table.render({
					elem: '#myTable',
					url: '/up/getUP',
					toolbar: true,
					height: 300,
					page: true,
					cols: [
						[{type:'radio'},{
							field: 'buildBoardDate',
							title: '扫描时间',
						}, {
							field: 'uid',
							title: '扫描单号'
						}, {
							field: 'plateNo',
							title: '板号',
						}, {
							field: 'upperState',
							title: '上板状态',
							templet:function(result){
								if(result.upperState==0){
									return '待上板';
								}else if(result.upperState==1){
									return '已上板';
								}else if(result.upperState==2){
									return '已出货';
								}else if(result.upperState==3){
									return '已撤销';
								}
							}
						},{
							field: 'dname',
							title: '目的地',
						}, {
							field: 'takeTheCargoRouteName',
							title: '走货路线',
						}, {
							field: 'cdmName',
							title: '报关类型',
						}, {
							field: 'gname',
							title: '货物类型',
						},{
							field: 'upperPlateOutletsName',
							title: '上板网点',
						},{
							field: 'ocount',
							title: '订单数',
						} , {
							field: 'buildBoardDate',
							title: '建板日期',
						}, {
							field: 'creatorName',
							title: '建板人',
						}]
					]
					,limit: 3
					, limits:[3,4,5],
					id:'myTable'
				})

				$("#select").click(function () {
					table.reload('myTable', {
						url: '/up/getUP'
						,where: {
							'is':$("#is").val(),
							'number':$("#number").val(),
							'number':$("#number").val(),
							'buildBoardDate':$("#buildBoardDate").val(),
							'upperPlateOutlets':$("#upperPlateOutlets").val(),
							'deliveryOutlets':$("#deliveryOutlets").val(),
							'upperState':$("#upperState").val(),
							'boardStrategy':$("#boardStrategy").val(),
							'dataSource':$("#dataSource").val(),
							'customsDeclarationMethod':$("#cdm").val()

						} //设定异步数据接口的额外参数
						,page: {
							curr: 1 //重新从第 1 页开始
						}
					});
				})

				$("#AddUpperPlate").on("click", function() {
					layer.open({
						type: 2,
						content: 'AddUpperPlate.html',
						area: ['740px', '500px'],
						title: '新增上板',
						cancel: function(index, layero) {
							layer.close(index)
							return false;
						},
						end: function() { //弹出层销毁后的事件
							table.reload('myTable', {
								url: '/up/getUP'
								,page: {
									curr: 1 //重新从第 1 页开始
								}
							});
						}
					})
				})

				$("#cancelTheUpperPlate").click(function () {
					var checkStatus = table.checkStatus('myTable');
					var plateNo;
					$(checkStatus.data).each(function (i, o) {//o即为表格中一行的数据
						plateNo=o.plateNo;
					});
					if (plateNo==null) {
						layer.msg('请选择需要更改的信息');
						return false;
					}else{
						$.ajax({
							url:"/up/updUPByPlateNo",
							type:"post",
							dataType:"text",
							data:{'plateNo':plateNo,upperState:3},
							success:function (result) {
								if(result>0){
									layer.msg('撤销成功');
									table.reload('myTable', {
										url: '/up/getUP'
										,page: {
											curr: 1 //重新从第 1 页开始
										}
									});
								}else{
									layer.msg('撤销失败');
								}
							}
						})
					}
				})

				$("#UpdUpperPlate").on("click", function() {
					var checkStatus = table.checkStatus('myTable');
					var plateNo;
					$(checkStatus.data).each(function (i, o) {//o即为表格中一行的数据
						plateNo=o.plateNo;
					});
					if (plateNo==null) {
						layer.msg('请选择需要更改的信息');
						return false;
					}else{
						layer.open({
							type: 2,
							content: 'UpdUpperPlate.html',
							area: ['740px', '500px'],
							title: '修改上板',
							cancel: function(index, layero) {
								layer.close(index)
								return false;
							},
							success: function(layero, index) { //弹出层弹出后的回调函数
								var iframe = window['layui-layer-iframe' + index];// 获取子页面的iframe
								iframe.setPlateNo(plateNo);   // 向子页面的全局函数child传参
							},
							end: function() { //弹出层销毁后的事件
								table.reload('myTable', {
									url: '/up/getUP'
									,page: {
										curr: 1 //重新从第 1 页开始
									}
								});
							}
						})
					}
			})

		});
</script>
	</body>

</html>
